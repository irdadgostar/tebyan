<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ÙØ³ | Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #c0392b;
            --text-main: #2c3e50;
            --text-muted: #95a5a6;
            --border-radius: 16px;
            --shadow: 0 8px 30px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; padding-bottom: 80px; }
        
        .container { max-width: 700px; margin: 0 auto; }

        /* Header & Score */
        header {
            background: var(--primary);
            color: white;
            padding: 30px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .date-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        .total-score { font-size: 4rem; font-weight: 900; line-height: 1; margin: 10px 0; text-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .score-label { font-size: 1rem; opacity: 0.9; }

        /* Menu Button */
        .settings-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border-right: 5px solid transparent;
        }

        .card.virtue { border-right-color: var(--success); }
        .card.vice { border-right-color: var(--danger); }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-info h3 { margin: 0; font-size: 1.1rem; }
        .item-info p { margin: 5px 0 0; font-size: 0.8rem; color: var(--text-muted); }

        /* Counter Controls */
        .counter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 12px;
        }

        .btn-count {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }
        
        .btn-count:active { transform: scale(0.9); }
        .btn-minus { background: #e0e0e0; color: #555; }
        .btn-plus-v { background: var(--success); color: white; }
        .btn-plus-x { background: var(--danger); color: white; }

        .count-display {
            font-size: 1.3rem;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .note-input {
            width: 100%;
            border: 1px solid #eee;
            background: #fafafa;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* Result Box */
        .result-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            text-align: center;
            border: 2px dashed #ddd;
            display: none;
        }
        
        .result-title { font-weight: bold; margin-bottom: 10px; display: block; }

        /* Settings Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: var(--border-radius);
            padding: 25px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .list-editor { margin-bottom: 20px; }
        .list-item-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .input-group { display: flex; gap: 10px; margin-top: 10px; }
        .input-group input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        .btn-add { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
        .btn-del { background: transparent; color: var(--danger); border: none; cursor: pointer; font-size: 1.2rem; }
        
        .btn-close { background: var(--primary); color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; margin-top: 10px; }

        /* Floating Reset Button */
        .fab-reset {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--text-muted);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 90;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <button class="settings-btn" onclick="openSettings()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø¯Ø§Ø´/Ø¬Ø±ÛŒÙ…Ù‡</button>
        <div class="date-badge" id="dateDisplay"></div>
        <div class="score-label">ØªØ±Ø§Ø² Ø§Ø®Ù„Ø§Ù‚ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
        <div class="total-score" id="totalScore">0</div>
        <div id="scoreMessage">Ø±ÙˆØ²Øª Ø±Ø§ Ø¨Ø³Ø§Ø²...</div>
    </header>

    <!-- Result Box -->
    <div id="resultBox" class="result-box">
        <span class="result-title">Ù†ØªÛŒØ¬Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ù…Ø±ÙˆØ²:</span>
        <div id="resultText"></div>
    </div>

    <!-- Virtues List -->
    <h3 style="color: var(--success); margin-right: 10px;">ÙØ¶Ø§ÛŒÙ„ (ØªÙ‚ÙˆÛŒØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§)</h3>
    <div id="virtuesList"></div>

    <!-- Vices List -->
    <h3 style="color: var(--danger); margin-right: 10px;">Ø±Ø°Ø§ÛŒÙ„ (Ø¢Ø³ÛŒØ¨â€ŒØ²Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§)</h3>
    <div id="vicesList"></div>
</div>

<button class="fab-reset" onclick="resetDay()" title="Ø´Ø±ÙˆØ¹ Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯">â†º</button>

<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø¯Ø§Ø´ Ùˆ Ø¬Ø±ÛŒÙ…Ù‡</h2>
            <span style="cursor:pointer; font-size:1.5rem;" onclick="closeSettings()">Ã—</span>
        </div>

        <div class="list-editor">
            <h4>ğŸ Ù„ÛŒØ³Øª Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ù…Ø«Ø¨Øª)</h4>
            <div id="rewardsContainer"></div>
            <div class="input-group">
                <input type="text" id="newRewardInput" placeholder="Ù¾Ø§Ø¯Ø§Ø´ Ø¬Ø¯ÛŒØ¯...">
                <button class="btn-add" onclick="addSettingItem('reward')">+</button>
            </div>
        </div>

        <div class="list-editor">
            <h4>âš ï¸ Ù„ÛŒØ³Øª Ø¬Ø±ÛŒÙ…Ù‡â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ù…Ù†ÙÛŒ)</h4>
            <div id="penaltiesContainer"></div>
            <div class="input-group">
                <input type="text" id="newPenaltyInput" placeholder="Ø¬Ø±ÛŒÙ…Ù‡ Ø¬Ø¯ÛŒØ¯...">
                <button class="btn-add" onclick="addSettingItem('penalty')">+</button>
            </div>
        </div>

        <button class="btn-close" onclick="closeSettings()">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø³ØªÙ†</button>
    </div>
</div>

<script>
    // --- Initial Data Config ---
    const defaultData = {
        virtues: [
            { id: 'v1', title: 'Ø®Ø±Ø¯ÙˆØ±Ø²ÛŒ', desc: 'ØªØµÙ…ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù‚Ù„ Ùˆ Ø¯Ù„ÛŒÙ„' },
            { id: 'v2', title: 'Ø§Ù†Ø¶Ø¨Ø§Ø· Ø´Ø®ØµÛŒ', desc: 'Ù¾Ø§ÛŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ (ÙˆØ±Ø²Ø´/Ø¯Ø±Ø³)' },
            { id: 'v3', title: 'ØµØ¯Ø§Ù‚Øª', desc: 'Ø±Ø§Ø³ØªÚ¯ÙˆÛŒÛŒ Ùˆ Ø´ÙØ§ÙÛŒØª' },
            { id: 'v4', title: 'Ù‡Ù…Ø¯Ù„ÛŒ Ùˆ Ú©Ù…Ú©', desc: 'Ø¯Ø±Ú© Ø¯ÛŒÚ¯Ø±Ø§Ù† Ùˆ Ù…Ù‡Ø±Ø¨Ø§Ù†ÛŒ' },
            { id: 'v5', title: 'Ø³Ú©ÙˆØª Ùˆ Ú©Ù†ØªØ±Ù„', desc: 'Ú©Ù†ØªØ±Ù„ Ø®Ø´Ù… Ùˆ Ø²Ø¨Ø§Ù†' }
        ],
        vices: [
            { id: 'x1', title: 'Ø¯Ø±ÙˆØº Ùˆ ÙØ±ÛŒØ¨', desc: 'ØªØ­Ø±ÛŒÙ ÙˆØ§Ù‚Ø¹ÛŒØª' },
            { id: 'x2', title: 'ØªÙ†Ø¨Ù„ÛŒ', desc: 'ÙˆÙ‚Øªâ€ŒÚ©Ø´ÛŒ Ùˆ Ø§Ù‡Ù…Ø§Ù„' },
            { id: 'x3', title: 'Ø¢Ø³ÛŒØ¨ Ø²Ø¯Ù†', desc: 'Ø¢Ø²Ø§Ø± Ú©Ù„Ø§Ù…ÛŒ ÛŒØ§ Ø±ÙØªØ§Ø±ÛŒ' },
            { id: 'x4', title: 'Ù‚Ø¶Ø§ÙˆØª Ùˆ ØºÛŒØ¨Øª', desc: 'Ø¨Ø¯Ú¯ÙˆÛŒÛŒ Ù¾Ø´Øª Ø³Ø± Ø¯ÛŒÚ¯Ø±Ø§Ù†' },
            { id: 'x5', title: 'ØªÙˆØ¬ÛŒÙ‡', desc: 'Ø¨Ù‡Ø§Ù†Ù‡â€ŒØªØ±Ø§Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡' }
        ]
    };

    const defaultSettings = {
        rewards: ['Ø®Ø±ÛŒØ¯ ÛŒÚ© Ú©ØªØ§Ø¨', 'Ø¯ÛŒØ¯Ù† ÛŒÚ© ÙÛŒÙ„Ù… Ø®ÙˆØ¨', 'Ø®ÙˆØ±Ø¯Ù† ØºØ°Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡', 'ÛŒÚ© Ø³Ø§Ø¹Øª Ø§Ø³ØªØ±Ø§Ø­Øª Ù…Ø·Ù„Ù‚'],
        penalties: ['Û²Û° ØªØ§ Ø´Ù†Ø§ Ø³ÙˆØ¦Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡', 'Û±Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù† ØµØ¯Ù‚Ù‡', 'Ø­Ø°Ù Ø´Ø§Ù… Ø§Ù…Ø´Ø¨', 'Ù…Ø­Ø±ÙˆÙ…ÛŒØª Ø§Ø² Ø§ÛŒÙ†ØªØ±Ù†Øª']
    };

    // --- State Management ---
    let appState = JSON.parse(localStorage.getItem('amirAppState')) || {};
    let userSettings = JSON.parse(localStorage.getItem('amirAppSettings')) || defaultSettings;

    // --- Date Setup ---
    document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('fa-IR', { weekday: 'long', day: 'numeric', month: 'long' });

    // --- Core Functions ---

    function renderApp() {
        renderList('virtue', defaultData.virtues);
        renderList('vice', defaultData.vices);
        updateScoreBoard();
    }

    function renderList(type, items) {
        const container = document.getElementById(type === 'virtue' ? 'virtuesList' : 'vicesList');
        container.innerHTML = items.map(item => {
            const count = appState[item.id]?.count || 0;
            const note = appState[item.id]?.note || '';
            
            return `
            <div class="card ${type}">
                <div class="card-top">
                    <div class="item-info">
                        <h3>${item.title}</h3>
                        <p>${item.desc}</p>
                    </div>
                    <div class="counter-controls">
                        <button class="btn-count btn-minus" onclick="updateCount('${item.id}', -1)">-</button>
                        <span class="count-display">${count}</span>
                        <button class="btn-count ${type === 'virtue' ? 'btn-plus-v' : 'btn-plus-x'}" onclick="updateCount('${item.id}', 1)">+</button>
                    </div>
                </div>
                <input type="text" class="note-input" placeholder="ØªÙˆØ¶ÛŒØ­ ÛŒØ§ Ù…ØµØ¯Ø§Ù‚..." value="${note}" oninput="saveNote('${item.id}', this.value)">
            </div>
            `;
        }).join('');
    }

    function updateCount(id, change) {
        if (!appState[id]) appState[id] = { count: 0, note: '' };
        
        let newCount = appState[id].count + change;
        if (newCount < 0) newCount = 0; // No negative counts
        
        appState[id].count = newCount;
        saveState();
        renderApp(); // Re-render to update numbers and score
    }

    function saveNote(id, text) {
        if (!appState[id]) appState[id] = { count: 0, note: '' };
        appState[id].note = text;
        saveState();
    }

    function calculateTotalScore() {
        let score = 0;
        defaultData.virtues.forEach(v => score += (appState[v.id]?.count || 0));
        defaultData.vices.forEach(v => score -= (appState[v.id]?.count || 0));
        return score;
    }

    function updateScoreBoard() {
        const score = calculateTotalScore();
        const scoreEl = document.getElementById('totalScore');
        const msgEl = document.getElementById('scoreMessage');
        const resBox = document.getElementById('resultBox');
        const resText = document.getElementById('resultText');

        scoreEl.innerText = score > 0 ? `+${score}` : score;
        
        if (score > 0) {
            scoreEl.style.color = '#2ecc71';
            msgEl.innerText = "Ù…Ø³ÛŒØ± Ø¯Ø±Ø³Øª Ù‡Ù…ÛŒÙ† Ø§Ø³Øª.";
            resBox.style.display = 'block';
            resBox.style.borderColor = '#2ecc71';
            resText.innerHTML = `<span style="color:#27ae60">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù¾Ø§Ø¯Ø§Ø´:</span> ${getRandomItem(userSettings.rewards)}`;
        } else if (score < 0) {
            scoreEl.style.color = '#e74c3c';
            msgEl.innerText = "Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§ØµÙ„Ø§Ø­ Ù…Ø³ÛŒØ±.";
            resBox.style.display = 'block';
            resBox.style.borderColor = '#e74c3c';
            resText.innerHTML = `<span style="color:#c0392b">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¬Ø±ÛŒÙ…Ù‡:</span> ${getRandomItem(userSettings.penalties)}`;
        } else {
            scoreEl.style.color = 'white';
            msgEl.innerText = "Ø®Ù†Ø«ÛŒ. Ø­Ø±Ú©Øª Ú©Ù†.";
            resBox.style.display = 'none';
        }
    }

    function getRandomItem(array) {
        if (!array || array.length === 0) return "Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!";
        return array[Math.floor(Math.random() * array.length)];
    }

    function saveState() {
        localStorage.setItem('amirAppState', JSON.stringify(appState));
    }

    function resetDay() {
        if(confirm("Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ØŸ ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ ØµÙØ± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.")) {
            appState = {};
            saveState();
            renderApp();
        }
    }

    // --- Settings Logic ---

    function openSettings() {
        renderSettingsList('reward');
        renderSettingsList('penalty');
        document.getElementById('settingsModal').style.display = 'flex';
    }

    function closeSettings() {
        document.getElementById('settingsModal').style.display = 'none';
        updateScoreBoard(); // Update result suggestion if list changed
    }

    function renderSettingsList(type) {
        const list = type === 'reward' ? userSettings.rewards : userSettings.penalties;
        const container = document.getElementById(type === 'reward' ? 'rewardsContainer' : 'penaltiesContainer');
        
        container.innerHTML = list.map((item, index) => `
            <div class="list-item-row">
                <span>${item}</span>
                <button class="btn-del" onclick="removeItem('${type}', ${index})">Ã—</button>
            </div>
        `).join('');
    }

    function addSettingItem(type) {
        const input = document.getElementById(type === 'reward' ? 'newRewardInput' : 'newPenaltyInput');
        const val = input.value.trim();
        if (val) {
            if (type === 'reward') userSettings.rewards.push(val);
            else userSettings.penalties.push(val);
            
            localStorage.setItem('amirAppSettings', JSON.stringify(userSettings));
            input.value = '';
            renderSettingsList(type);
        }
    }

    function removeItem(type, index) {
        if (type === 'reward') userSettings.rewards.splice(index, 1);
        else userSettings.penalties.splice(index, 1);
        
        localStorage.setItem('amirAppSettings', JSON.stringify(userSettings));
        renderSettingsList(type);
    }

    // Init
    renderApp();

</script>
</body>
</html>
